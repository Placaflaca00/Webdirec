<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Mis Direcciones Guardadas</title>
    <style>
        * {
            box-sizing: border-box;
            margin: 0;
            padding: 0;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        }
        
        body {
            background-color: #f5f5f5;
            padding: 20px;
            max-width: 1200px;
            margin: 0 auto;
        }
        
        header {
            background-color: #4285f4;
            color: white;
            padding: 20px;
            border-radius: 10px;
            margin-bottom: 20px;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
        }
        
        h1 {
            font-size: 24px;
            margin-bottom: 15px;
        }
        
        .add-form {
            display: flex;
            flex-direction: column;
            gap: 10px;
        }
        
        #address-input {
            padding: 12px;
            border: none;
            border-radius: 5px;
            font-size: 16px;
        }
        
        #name-input {
            padding: 12px;
            border: none;
            border-radius: 5px;
            font-size: 16px;
        }
        
        .form-buttons {
            display: flex;
            gap: 10px;
        }
        
        button {
            background-color: #34a853;
            color: white;
            border: none;
            border-radius: 5px;
            padding: 10px 15px;
            cursor: pointer;
            font-size: 16px;
            transition: background-color 0.3s;
        }
        
        button:hover {
            background-color: #2d8e49;
        }
        
        .saved-locations {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(300px, 1fr));
            gap: 20px;
            margin-top: 30px;
        }
        
        .location-card {
            background-color: white;
            border-radius: 10px;
            overflow: hidden;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
            animation: fadeIn 0.5s;
        }
        
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(20px); }
            to { opacity: 1; transform: translateY(0); }
        }
        
        .location-image {
            width: 100%;
            height: 180px;
            object-fit: cover;
        }
        
        .location-details {
            padding: 20px;
        }
        
        .location-name {
            font-size: 20px;
            margin-bottom: 10px;
        }
        
        .location-address {
            color: #666;
            margin-bottom: 15px;
            font-size: 14px;
        }
        
        .directions-button {
            background-color: #ea4335;
            width: 100%;
        }
        
        .directions-button:hover {
            background-color: #c5372c;
        }
        
        .card-actions {
            display: flex;
            gap: 10px;
            margin-top: 10px;
        }
        
        .delete-button {
            background-color: #ea4335;
            width: 100%;
        }
        
        .no-locations {
            text-align: center;
            margin-top: 50px;
            color: #666;
        }
        
        .loading {
            display: none;
            text-align: center;
            padding: 20px;
        }
        
        .spinner {
            border: 4px solid rgba(0, 0, 0, 0.1);
            border-radius: 50%;
            border-top: 4px solid #4285f4;
            width: 30px;
            height: 30px;
            animation: spin 1s linear infinite;
            margin: 0 auto 10px;
        }
        
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
        
        @media (max-width: 600px) {
            .add-form {
                flex-direction: column;
            }
        }
    </style>
</head>
<body>
    <header>
        <h1>Mis Direcciones Guardadas</h1>
        <div class="add-form">
            <input type="text" id="name-input" placeholder="Nombre del lugar (ej: Mi Casa, Trabajo, etc.)">
            <input type="text" id="address-input" placeholder="Dirección exacta (ej: Museo Americano de Historia Natural, 200 Central Park W, NY)">
            <div class="form-buttons">
                <button id="add-button">Guardar Dirección</button>
            </div>
        </div>
    </header>
    
    <div class="loading" id="loading">
        <div class="spinner"></div>
        <p>Guardando dirección...</p>
    </div>
    
    <div id="locations-container" class="saved-locations">
        <!-- Aquí se mostrarán las tarjetas de ubicaciones -->
    </div>
    
    <div class="no-locations" id="no-locations" style="display: none;">
        <p>No hay direcciones guardadas. Agrega tu primera dirección arriba.</p>
    </div>
    
    <script>
        // Elementos del DOM
        const nameInput = document.getElementById('name-input');
        const addressInput = document.getElementById('address-input');
        const addButton = document.getElementById('add-button');
        const locationsContainer = document.getElementById('locations-container');
        const noLocationsMessage = document.getElementById('no-locations');
        const loadingIndicator = document.getElementById('loading');
        
        // Array para almacenar las ubicaciones guardadas
        let savedLocations = JSON.parse(localStorage.getItem('savedLocations')) || [];
        
        // Inicializar la aplicación
        function init() {
            // Renderizar las ubicaciones guardadas
            renderSavedLocations();
            
            // Evento para agregar una nueva ubicación
            addButton.addEventListener('click', addLocation);
            
            // También permitir añadir al presionar Enter en los inputs
            nameInput.addEventListener('keypress', function(e) {
                if (e.key === 'Enter') {
                    addressInput.focus();
                }
            });
            
            addressInput.addEventListener('keypress', function(e) {
                if (e.key === 'Enter') {
                    addLocation();
                }
            });
        }
        
        // Agregar una nueva ubicación
        function addLocation() {
            const name = nameInput.value.trim();
            const address = addressInput.value.trim();
            
            // Validar que ambos campos tengan contenido
            if (!name) {
                alert('Por favor, ingresa un nombre para la ubicación.');
                nameInput.focus();
                return;
            }
            
            if (!address) {
                alert('Por favor, ingresa una dirección exacta.');
                addressInput.focus();
                return;
            }
            
            // Mostrar indicador de carga
            loadingIndicator.style.display = 'block';
            
            // Obtener una imagen representativa usando la API oficial de Unsplash
            const searchTerms = getSearchTermsFromAddress(address);
            const unsplashApiKey = 'UuKNQXen6EYvY6xyEoFxY2rorUG08_EoWCDpx1ydme0';
            
            // Hacer la solicitud a la API de Unsplash
            fetch(`https://api.unsplash.com/search/photos?query=${encodeURIComponent(searchTerms)}&client_id=${unsplashApiKey}`)
              .then(response => response.json())
              .then(data => {
                let imageUrl = 'https://via.placeholder.com/400x300?text=No+Image+Found';
                
                // Verificar si hay resultados y tomar el primero
                if (data.results && data.results.length > 0) {
                  imageUrl = data.results[0].urls.regular;
                }
                
                // Crear nueva ubicación con la imagen obtenida
                const newLocation = {
                    id: Date.now().toString(), // ID único basado en timestamp
                    name: name,
                    address: address,
                    imageUrl: imageUrl
                };
                
                // Añadir a la lista de ubicaciones guardadas
                savedLocations.push(newLocation);
                
                // Guardar en localStorage
                localStorage.setItem('savedLocations', JSON.stringify(savedLocations));
                
                // Limpiar inputs
                nameInput.value = '';
                addressInput.value = '';
                nameInput.focus();
                
                // Actualizar la visualización
                renderSavedLocations();
                
                // Ocultar indicador de carga
                loadingIndicator.style.display = 'none';
              })
              .catch(error => {
                console.error('Error fetching image:', error);
                
                // En caso de error, usar una imagen de respaldo
                const newLocation = {
                    id: Date.now().toString(),
                    name: name,
                    address: address,
                    imageUrl: 'https://via.placeholder.com/400x300?text=Error+Loading+Image'
                };
                
                // Añadir a la lista de ubicaciones guardadas
                savedLocations.push(newLocation);
                
                // Guardar en localStorage
                localStorage.setItem('savedLocations', JSON.stringify(savedLocations));
                
                // Limpiar inputs
                nameInput.value = '';
                addressInput.value = '';
                nameInput.focus();
                
                // Actualizar la visualización
                renderSavedLocations();
                
                // Ocultar indicador de carga
                loadingIndicator.style.display = 'none';
              });
        }
        
        // Obtener términos de búsqueda relevantes de la dirección
        function getSearchTermsFromAddress(address) {
            // Extraer palabras clave importantes de la dirección
            const parts = address.split(',');
            const firstPart = parts[0].trim();
            
            // Si hay palabras como "museo", "parque", etc., usarlas como términos de búsqueda
            const keywords = ['museo', 'parque', 'restaurant', 'cafe', 'hotel', 'teatro', 
                             'biblioteca', 'universidad', 'plaza', 'estadio', 'aeropuerto',
                             'estación', 'centro comercial', 'iglesia', 'catedral', 'monumento'];
            
            for (const keyword of keywords) {
                if (firstPart.toLowerCase().includes(keyword)) {
                    return keyword;
                }
            }
            
            // Si no hay palabras clave, usar el nombre del lugar o la primera parte de la dirección
            return firstPart;
        }
        
        // Renderizar las ubicaciones guardadas
        function renderSavedLocations() {
            // Limpiar el contenedor
            locationsContainer.innerHTML = '';
            
            // Mostrar mensaje si no hay ubicaciones
            if (savedLocations.length === 0) {
                noLocationsMessage.style.display = 'block';
                return;
            } else {
                noLocationsMessage.style.display = 'none';
            }
            
            // Renderizar cada ubicación
            savedLocations.forEach(location => {
                const locationCard = document.createElement('div');
                locationCard.className = 'location-card';
                locationCard.dataset.id = location.id;
                
                locationCard.innerHTML = `
                    <img class="location-image" src="${location.imageUrl}" alt="${location.name}">
                    <div class="location-details">
                        <h2 class="location-name">${location.name}</h2>
                        <p class="location-address">${location.address}</p>
                        <button class="directions-button" data-address="${location.address}">Ver ruta en Google Maps</button>
                        <div class="card-actions">
                            <button class="delete-button" data-id="${location.id}">Eliminar</button>
                        </div>
                    </div>
                `;
                
                // Agregar al contenedor
                locationsContainer.appendChild(locationCard);
            });
            
            // Añadir event listeners a los botones de las tarjetas
            document.querySelectorAll('.directions-button').forEach(button => {
                button.addEventListener('click', function() {
                    const address = this.getAttribute('data-address');
                    getDirections(address);
                });
            });
            
            document.querySelectorAll('.delete-button').forEach(button => {
                button.addEventListener('click', function() {
                    const id = this.getAttribute('data-id');
                    deleteLocation(id);
                });
            });
        }
        
        // Obtener direcciones en Google Maps
        function getDirections(address) {
            const destination = encodeURIComponent(address);
            
            // Usar la URL de Google Maps para obtener direcciones
            // Esto usará la ubicación actual como origen
            const mapsUrl = `https://www.google.com/maps/dir/?api=1&destination=${destination}&travelmode=driving`;
            
            // Abrir Google Maps en una nueva pestaña
            window.open(mapsUrl, '_blank');
        }
        
        // Eliminar una ubicación
        function deleteLocation(id) {
            if (confirm('¿Estás seguro de que quieres eliminar esta dirección?')) {
                // Filtrar la ubicación a eliminar
                savedLocations = savedLocations.filter(location => location.id !== id);
                
                // Guardar en localStorage
                localStorage.setItem('savedLocations', JSON.stringify(savedLocations));
                
                // Actualizar la visualización
                renderSavedLocations();
            }
        }
        
        // Iniciar la aplicación cuando se cargue el documento
        document.addEventListener('DOMContentLoaded', init);
    </script>
</body>
</html>